"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var child_process_1 = require("child_process");
var chai_1 = require("chai");
var fs_extra_1 = __importDefault(require("fs-extra"));
var mocha_1 = require("mocha");
var urls_1 = require("../../src/urls");
var utils_1 = require("../../src/utils");
var constants_1 = require("../constants");
var functions_1 = require("../functions");
mocha_1.describe('Test clasp clone <scriptId> function', function () {
    before(functions_1.setup);
    mocha_1.it('should clone a project with scriptId correctly', function () {
        functions_1.cleanup();
        var result = child_process_1.spawnSync(constants_1.CLASP, ['clone', constants_1.SCRIPT_ID], { encoding: 'utf8' });
        chai_1.expect(result.stdout).to.contain('Cloned');
        chai_1.expect(result.stdout).to.contain('files.');
        chai_1.expect(result.stdout).to.contain(utils_1.LOG.STATUS_PUSH);
        chai_1.expect(result.stdout).to.contain(utils_1.LOG.STATUS_IGNORE);
        chai_1.expect(result.stderr).to.equal('');
        chai_1.expect(result.status).to.equal(0);
    });
    mocha_1.it('should clone a project with scriptURL correctly', function () {
        functions_1.cleanup();
        var result = child_process_1.spawnSync(constants_1.CLASP, ['clone', urls_1.URL.SCRIPT(constants_1.SCRIPT_ID)], { encoding: 'utf8' });
        chai_1.expect(result.stdout).to.contain('Cloned');
        chai_1.expect(result.stdout).to.contain('files.');
        chai_1.expect(result.stdout).to.contain(utils_1.LOG.STATUS_PUSH);
        chai_1.expect(result.stdout).to.contain(utils_1.LOG.STATUS_IGNORE);
        chai_1.expect(result.stderr).to.equal('');
        chai_1.expect(result.status).to.equal(0);
    });
    mocha_1.it('should give an error on a non-existing project', function () {
        fs_extra_1.default.removeSync('./.clasp.json');
        var result = child_process_1.spawnSync(constants_1.CLASP, ['clone', 'non-existing-project'], { encoding: 'utf8' });
        chai_1.expect(result.stderr).to.contain(utils_1.ERROR.SCRIPT_ID);
        chai_1.expect(result.status).to.equal(1);
    });
    after(functions_1.cleanup);
});
mocha_1.describe('Test clasp clone function', function () {
    before(functions_1.setup);
    mocha_1.it('should prompt for which script to clone correctly', function () {
        child_process_1.spawnSync('rm', ['.clasp.json']);
        var result = child_process_1.spawnSync(constants_1.CLASP, ['clone'], { encoding: 'utf8' });
        chai_1.expect(result.stdout).to.contain(utils_1.LOG.CLONE_SCRIPT_QUESTION);
        chai_1.expect(result.stderr).to.equal('');
    });
    mocha_1.it('should prompt which project to clone and clone it', function () {
        functions_1.cleanup();
        var result = child_process_1.spawnSync(constants_1.CLASP, ['clone'], { encoding: 'utf8', input: '\n' });
        chai_1.expect(result.stdout).to.contain(utils_1.LOG.CLONE_SCRIPT_QUESTION);
        chai_1.expect(result.stdout).to.contain('Cloned');
        chai_1.expect(result.stdout).to.contain('files.');
        chai_1.expect(result.stdout).to.contain(utils_1.LOG.STATUS_PUSH);
        chai_1.expect(result.stdout).to.contain(utils_1.LOG.STATUS_IGNORE);
        chai_1.expect(result.stderr).to.equal('');
        chai_1.expect(result.status).to.equal(0);
    });
    mocha_1.it('should give an error if .clasp.json already exists', function () {
        fs_extra_1.default.writeFileSync('.clasp.json', '');
        var result = child_process_1.spawnSync(constants_1.CLASP, ['clone'], { encoding: 'utf8' });
        chai_1.expect(result.stderr).to.contain('Project file (.clasp.json) already exists.');
        chai_1.expect(result.status).to.equal(1);
    });
    after(functions_1.cleanup);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xvbmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjbG9uZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLCtDQUEwQztBQUMxQyw2QkFBOEI7QUFDOUIsc0RBQTBCO0FBQzFCLCtCQUFxQztBQUNyQyx1Q0FBcUM7QUFDckMseUNBQTZDO0FBQzdDLDBDQUFnRDtBQUNoRCwwQ0FBOEM7QUFFOUMsZ0JBQVEsQ0FBQyxzQ0FBc0MsRUFBRTtJQUMvQyxNQUFNLENBQUMsaUJBQUssQ0FBQyxDQUFDO0lBQ2QsVUFBRSxDQUFDLGdEQUFnRCxFQUFFO1FBQ25ELG1CQUFPLEVBQUUsQ0FBQztRQUNWLElBQU0sTUFBTSxHQUFHLHlCQUFTLENBQ3RCLGlCQUFLLEVBQUUsQ0FBQyxPQUFPLEVBQUUscUJBQVMsQ0FBQyxFQUFFLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxDQUNsRCxDQUFDO1FBQ0YsYUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzNDLGFBQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMzQyxhQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsV0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ2xELGFBQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxXQUFHLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDcEQsYUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ25DLGFBQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNw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